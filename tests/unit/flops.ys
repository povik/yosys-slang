read_slang <<EOF
module dffsr(CLK, SET, CLR, D, Q);

  parameter WIDTH = 8;
  parameter SET_POLARITY = 1;
  input CLK;
  input [WIDTH-1:0] SET, CLR, D;
  output reg [WIDTH-1:0] Q;

  wire pos_clk = ~CLK;
  wire [WIDTH-1:0] pos_set = SET_POLARITY ? SET : ~SET;
  wire single_bit_pos_set = SET_POLARITY ? SET[0] : ~SET[0];

  always @(posedge single_bit_pos_set, posedge pos_clk)
    if (single_bit_pos_set)
      Q[1] <= D[1];
    else
      Q[1] <= 0;

  always @(posedge pos_set[1], posedge pos_clk)
    if (pos_set[1])
      Q[1] <= D[1];
    else
      Q[1] <= 0;

  always @(posedge pos_set[1:1], posedge pos_clk)
    if (pos_set[1:1])
      Q[1] <= D[1];
    else
      Q[1] <= 0;

  genvar i;
  generate
  for (i = 0; i < WIDTH; i = i+1) begin: slices
    always @(posedge pos_set[i], posedge pos_clk)
      if (pos_set[i])
        Q[i] <= 1;
      else
        Q[i] <= D[i];
    end
  endgenerate

endmodule
EOF
